<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zotpress Demo - Standalone Zotero API Test</title>
  <style>
    :root {
      --primary: #cc2936;
      --bg: #fafafa;
      --text: #333;
      --border: #ddd;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 2rem;
      max-width: 900px;
      margin: 0 auto;
    }
    h1 { color: var(--primary); margin-bottom: 1rem; }
    h2 { margin: 2rem 0 1rem; border-bottom: 2px solid var(--primary); padding-bottom: 0.5rem; }

    .form-group { margin-bottom: 1rem; }
    label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
    input[type="text"], input[type="number"], select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 1rem;
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .results {
      background: white;
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 1rem;
      margin-top: 1rem;
      min-height: 200px;
    }
    .item {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .item:last-child { border-bottom: none; }
    .item-title { font-weight: 600; color: var(--primary); }
    .item-authors { color: #666; font-style: italic; }
    .item-meta { font-size: 0.875rem; color: #999; margin-top: 0.5rem; }

    .error { background: #fee; color: #c00; padding: 1rem; border-radius: 4px; }
    .loading { text-align: center; padding: 2rem; color: #666; }

    code {
      background: #f0f0f0;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-size: 0.9rem;
    }
    pre {
      background: #f0f0f0;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
    }

    .shortcode-examples {
      background: white;
      padding: 1rem;
      border-radius: 4px;
      border: 1px solid var(--border);
    }
    .shortcode-examples code {
      display: block;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Zotpress Demo</h1>
  <p>Test your Zotero API connection without WordPress.</p>

  <h2>1. Enter Credentials</h2>
  <form id="zotero-form">
    <div class="form-group">
      <label for="userId">Zotero User ID</label>
      <input type="text" id="userId" placeholder="123456" required>
      <small>Find at <a href="https://www.zotero.org/settings/keys" target="_blank">zotero.org/settings/keys</a></small>
    </div>

    <div class="form-group">
      <label for="apiKey">API Key (optional for public libraries)</label>
      <input type="text" id="apiKey" placeholder="abcDEF123...">
    </div>

    <div class="form-group">
      <label for="limit">Number of items</label>
      <input type="number" id="limit" value="5" min="1" max="100">
    </div>

    <div class="form-group">
      <label for="style">Citation Style</label>
      <select id="style">
        <option value="apa">APA 7th</option>
        <option value="chicago-note-bibliography">Chicago (Notes)</option>
        <option value="modern-language-association">MLA 9th</option>
        <option value="harvard-cite-them-right">Harvard</option>
        <option value="ieee">IEEE</option>
        <option value="vancouver">Vancouver</option>
      </select>
    </div>

    <button type="submit" id="fetchBtn">Fetch Items</button>
  </form>

  <h2>2. Results</h2>
  <div id="results" class="results">
    <p style="color: #999; text-align: center;">Enter your credentials and click "Fetch Items"</p>
  </div>

  <h2>3. WordPress Shortcode</h2>
  <div id="shortcode-output" class="shortcode-examples">
    <p>After fetching, your shortcode will appear here:</p>
    <code id="generated-shortcode">[zotpress userid="YOUR_ID" limit="5"]</code>
  </div>

  <h2>4. More Shortcode Examples</h2>
  <div class="shortcode-examples">
    <code>[zotpress limit="10"]</code>
    <code>[zotpress collection="ABCD1234" style="chicago-note-bibliography"]</code>
    <code>[zotpress author="Smith" year="2023"]</code>
    <code>[zotpress tag="machine-learning"]</code>
    <code>[zotpress item="XYZ12345"]</code>
  </div>

  <script>
    const form = document.getElementById('zotero-form');
    const results = document.getElementById('results');
    const fetchBtn = document.getElementById('fetchBtn');
    const shortcodeOutput = document.getElementById('generated-shortcode');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const userId = document.getElementById('userId').value.trim();
      const apiKey = document.getElementById('apiKey').value.trim();
      const limit = document.getElementById('limit').value;
      const style = document.getElementById('style').value;

      if (!userId) {
        results.innerHTML = '<div class="error">Please enter your Zotero User ID</div>';
        return;
      }

      fetchBtn.disabled = true;
      results.innerHTML = '<div class="loading">Fetching from Zotero API...</div>';

      try {
        const url = `https://api.zotero.org/users/${userId}/items?limit=${limit}&format=json&v=3`;
        const headers = { 'Content-Type': 'application/json' };
        if (apiKey) headers['Zotero-API-Key'] = apiKey;

        const response = await fetch(url, { headers });

        if (!response.ok) {
          throw new Error(`API Error: ${response.status} ${response.statusText}`);
        }

        const items = await response.json();

        if (items.length === 0) {
          results.innerHTML = '<p>No items found. Check your User ID or make your library public.</p>';
        } else {
          results.innerHTML = items.map(item => {
            const data = item.data;
            const authors = data.creators?.filter(c => c.creatorType === 'author')
              .map(c => c.lastName || c.name).join(', ') || 'Unknown';
            const year = data.date?.match(/\d{4}/)?.[0] || '';

            return `
              <div class="item">
                <div class="item-title">${escapeHtml(data.title || 'Untitled')}</div>
                <div class="item-authors">${escapeHtml(authors)}${year ? ` (${year})` : ''}</div>
                <div class="item-meta">
                  Type: ${data.itemType} | Key: ${item.key}
                </div>
              </div>
            `;
          }).join('');
        }

        // Update shortcode
        shortcodeOutput.textContent = `[zotpress userid="${userId}" limit="${limit}" style="${style}"]`;

      } catch (err) {
        results.innerHTML = `<div class="error">${escapeHtml(err.message)}</div>`;
      } finally {
        fetchBtn.disabled = false;
      }
    });

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
