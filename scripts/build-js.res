/* Auto-translated placeholder from TypeScript. */
let originalTs = "/**\n * JavaScript Build Script\n *\n * Modern JavaScript bundling with esbuild via Deno.\n * Produces optimized bundles for WordPress plugin.\n *\n * @module\n */\n\nimport { ensureDir } from '@std/fs';\nimport { join, basename } from '@std/path';\n// @ts-ignore: esbuild types\nimport * as esbuild from 'esbuild';\n\nconst SRC_DIR = './src/js';\nconst DIST_DIR = './dist/js';\nconst LEGACY_JS_DIR = './js';\n\n/**\n * JS build configuration\n */\ninterface JSConfig {\n  readonly minify: boolean;\n  readonly sourceMaps: boolean;\n  readonly target: string[];\n}\n\nconst config: JSConfig = {\n  minify: Deno.env.get('NODE_ENV') === 'production',\n  sourceMaps: Deno.env.get('NODE_ENV') !== 'production',\n  target: ['es2020', 'chrome90', 'firefox90', 'safari14'],\n};\n\n/**\n * Build a single JavaScript/TypeScript file with esbuild\n */\nasync function buildFile(inputPath: string, outputPath: string): Promise<void> {\n  const filename = basename(inputPath);\n  console.log(`  Bundling: ${filename}`);\n\n  const result = await esbuild.build({\n    entryPoints: [inputPath],\n    outfile: outputPath,\n    bundle: true,\n    minify: config.minify,\n    sourcemap: config.sourceMaps,\n    target: config.target,\n    format: 'iife',\n    globalName: 'Zotpress',\n    platform: 'browser',\n    external: ['jquery', 'wp'],\n    define: {\n      'process.env.NODE_ENV': JSON.stringify(\n        Deno.env.get('NODE_ENV') || 'development'\n      ),\n    },\n    metafile: true,\n  });\n\n  if (result.metafile) {\n    const outputs = Object.values(result.metafile.outputs)[0];\n    if (outputs) {\n      console.log(`    → ${outputs.bytes} bytes`);\n    }\n  }\n}\n\n/**\n * Minify a legacy JavaScript file\n */\nasync function minifyFile(inputPath: string, outputPath: string): Promise<void> {\n  const filename = basename(inputPath);\n  console.log(`  Minifying: ${filename}`);\n\n  const code = await Deno.readTextFile(inputPath);\n\n  const result = await esbuild.transform(code, {\n    minify: true,\n    sourcemap: config.sourceMaps,\n    target: config.target,\n    format: 'iife',\n  });\n\n  await Deno.writeTextFile(outputPath, result.code);\n\n  if (result.map && config.sourceMaps) {\n    await Deno.writeTextFile(`${outputPath}.map`, result.map);\n  }\n\n  const inputSize = new TextEncoder().encode(code).length;\n  const outputSize = new TextEncoder().encode(result.code).length;\n  const reduction = ((1 - outputSize / inputSize) * 100).toFixed(1);\n\n  console.log(`    ${inputSize} → ${outputSize} bytes (${reduction}% reduction)`);\n}\n\n/**\n * Find all JS/TS files in a directory\n */\nasync function findJSFiles(dir: string, extensions = ['.ts', '.js']): Promise<string[]> {\n  const files: string[] = [];\n\n  try {\n    for await (const entry of Deno.readDir(dir)) {\n      if (entry.isFile) {\n        const isTarget = extensions.some(\n          (ext) => entry.name.endsWith(ext) && !entry.name.endsWith('.min.js')\n        );\n        if (isTarget) {\n          files.push(join(dir, entry.name));\n        }\n      }\n    }\n  } catch {\n    // Directory may not exist yet\n  }\n\n  return files;\n}\n\n/**\n * Main JS build function\n */\nasync function main(): Promise<void> {\n  console.log('⚡ Building JavaScript assets...\\n');\n\n  await ensureDir(DIST_DIR);\n\n  // Build modern TypeScript from src/js\n  const srcFiles = await findJSFiles(SRC_DIR, ['.ts', '.tsx']);\n  if (srcFiles.length > 0) {\n    console.log(`Found ${srcFiles.length} files in ${SRC_DIR}:`);\n    for (const file of srcFiles) {\n      const outputFile = join(\n        DIST_DIR,\n        basename(file).replace(/\\.(ts|tsx)$/, '.min.js')\n      );\n      await buildFile(file, outputFile);\n    }\n  }\n\n  // Minify legacy JavaScript files\n  const legacyFiles = await findJSFiles(LEGACY_JS_DIR, ['.js']);\n  if (legacyFiles.length > 0) {\n    console.log(`\\nFound ${legacyFiles.length} legacy files in ${LEGACY_JS_DIR}:`);\n    for (const file of legacyFiles) {\n      const filename = basename(file);\n      // Skip already minified files\n      if (filename.includes('.min.')) continue;\n\n      const outputFile = join(DIST_DIR, filename.replace('.js', '.min.js'));\n      await minifyFile(file, outputFile);\n    }\n  }\n\n  // Stop esbuild service\n  await esbuild.stop();\n\n  console.log('\\n✓ JavaScript build complete');\n}\n\n// Run if executed directly\nif (import.meta.main) {\n  main();\n}\n\nexport { main, buildFile, minifyFile, findJSFiles };\n"
/* TODO: Port to ReScript. */
